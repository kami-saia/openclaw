# SKILL.md - Trader (Alpaca)

## Description

Autonomous trading skill using Alpaca Markets API. Capable of market data analysis, paper trading, and portfolio management.

## Credentials

- Location: `~/.openclaw/credentials/alpaca_credentials.json`
- Required keys: `APCA_API_KEY_ID`, `APCA_API_SECRET_KEY`, `APCA_API_BASE_URL` (optional, defaults to paper).

## Environment

- Venv: `/home/damon/qwen-venv`
- SDK: `alpaca-py` (Note: `alpaca-trade-api` is legacy)

## Protocol: Trade Execution

Before executing a new trade:

1.  **Check `TRADE_JOURNAL.md`:** Review past lessons to avoid repeat mistakes.
2.  **Verify Status:** Run `status.py` to see current exposure.
3.  **Execute:** Use `execute_v1.py` or custom script.

## Architecture: The Sentinel

The trading system runs as a hybrid of manual execution and automated monitoring.

### Components

1.  **Execution:** Manual scripts (`execute_v1.py`, `execute_mstr_fix.py`) run by the Agent to enter positions.
2.  **Monitoring (`sentinel.py`):**
    - **Type:** Background Python process.
    - **Function:** Connects to Alpaca WebSocket, streams data for active positions (`AMZN`, `MSTR`).
    - **Logic:** Alerts if PnL varies by > +/- 5% from entry.
    - **Notification:** Sends a system event to the **Main Session** (Control Room) via Gateway API (`/api/v1/sessions/send`).
3.  **Sentinel Operations (Monitoring):**
    - **Launch:** Must use `setsid` to break process group linkage and prevent SIGTERM on session exit.
    - **Command:** `setsid /home/damon/qwen-venv/bin/python3 skills/trader/sentinel.py > skills/trader/sentinel.std.log 2>&1 < /dev/null &`
    - **Logs:** `sentinel.log` (App), `sentinel.std.log` (Crash/Stderr).
    - **Schedule:** Start 16:25 EET, Stop 23:05 EET (Mon-Fri).

### Protocol: [SENTINEL ALERT]

If you receive a message starting with `[SENTINEL ALERT]`:

1.  **Do Not Panic.** This is an automated notification from your background process.
2.  **Verify:** Check the claimed price against a fresh quote if possible (or trust the stream).
3.  **Report:** Immediately inform the Admin (Damon) in the Control Room.
    - _"Sentinel reports MSTR is down 5%. PnL is -$1,500."_
4.  **Action:** Ask for instructions ("Cut it?" "Hold?") or execute the pre-agreed Stop Loss/Take Profit if explicitly authorized in `MEMORY.md`.

## Scripts

- `check_capabilities.py`: Verify account permissions.
- `execute_v1.py`: Enter initial positions.
- `sentinel.py`: The monitoring daemon.
- `status.py`: Simple account health check.

## Active Strategy: Scouter V1

- **Goal:** +50% PnL (The Gauntlet).
- **Positions:** Long AMZN. (MSTR Closed 2026-02-06 @ $126.39).
- **Thesis:** AMZN (Mean Reversion), MSTR (Short Squeeze - Failed).
